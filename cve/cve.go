package cve

import (
    "github.com/mcuadros/go-version"
)

type Severity string

const (
    UnknownSeverity    Severity = "unknown"
    NegligibleSeverity Severity = "negligible"
    LowSeverity        Severity = "low"
    MediumSeverity     Severity = "medium"
    HighSeverity       Severity = "high"
    CriticalSeverity   Severity = "critical"
)

type CVE struct {
    Id               string
    Description      string
    Severity         Severity
    AffectedPackages []AffectedPackage
}

func (cve CVE) DoesItAffect(pkg Package) (bool) {
    for _, affected := range cve.AffectedPackages {
        if affected.Name != pkg.Name {
            continue
        }

        return version.CompareSimple(pkg.Version, affected.PatchedVersion) == -1
    }

    return false
}

type AffectedPackage struct {
    Name string
    // This is private so it can only be set through "PatchedBy" method that takes care of normalizing the Version string beforehand.
    PatchedVersion string
}

type Package struct {
    Name    string
    Version string
}
